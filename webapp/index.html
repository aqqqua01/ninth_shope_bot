<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ Steam</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="config.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
            color: var(--tg-theme-text-color, #000000);
            margin-bottom: 8px;
        }

        .header p {
            color: var(--tg-theme-hint-color, #999999);
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--tg-theme-text-color, #000000);
        }

        .form-label.required::after {
            content: " *";
            color: #e74c3c;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--tg-theme-button-color, #0088cc);
            border-radius: 8px;
            font-size: 16px;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            transition: border-color 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--tg-theme-button-color, #0088cc);
            box-shadow: 0 0 0 3px rgba(0, 136, 204, 0.1);
        }

        .form-input:invalid {
            border-color: #e74c3c;
        }

        .form-input[readonly] {
            background: var(--tg-theme-secondary-bg-color, #f8f9fa);
            color: var(--tg-theme-hint-color, #999999);
            cursor: not-allowed;
        }

        .total-display {
            background: linear-gradient(135deg, var(--tg-theme-button-color, #0088cc), #005580);
            color: white;
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            font-weight: 600;
            font-size: 18px;
            margin: 20px 0;
            box-shadow: 0 4px 12px rgba(0, 136, 204, 0.3);
        }

        .payment-details {
            background: var(--tg-theme-secondary-bg-color, #f8f9fa);
            border: 1px solid var(--tg-theme-button-color, #0088cc);
            border-radius: 8px;
            padding: 16px;
            margin: 20px 0;
        }

        .payment-details h3 {
            margin-bottom: 12px;
            color: var(--tg-theme-text-color, #000000);
            font-size: 16px;
        }

        .payment-details pre {
            font-family: monospace;
            font-size: 14px;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: var(--tg-theme-text-color, #000000);
            background: var(--tg-theme-bg-color, #ffffff);
            padding: 12px;
            border-radius: 6px;
            border: 1px solid var(--tg-theme-hint-color, #e0e0e0);
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 30px;
        }

        .btn {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 56px;
        }

        .btn-primary {
            background: var(--tg-theme-button-color, #0088cc);
            color: var(--tg-theme-button-text-color, #ffffff);
        }

        .btn-primary:hover {
            background: #005580;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 136, 204, 0.3);
        }

        .btn-secondary {
            background: transparent;
            color: var(--tg-theme-destructive-text-color, #e74c3c);
            border: 2px solid var(--tg-theme-destructive-text-color, #e74c3c);
        }

        .btn-secondary:hover {
            background: var(--tg-theme-destructive-text-color, #e74c3c);
            color: white;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .error-message {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }

        .currency {
            font-weight: 600;
            color: var(--tg-theme-button-color, #0088cc);
        }



        @media (max-width: 480px) {
            .container {
                padding: 0 10px;
            }
            
            .button-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí∞ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</h1>
            <p>–ë—ã—Å—Ç—Ä–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—É</p>
        </div>

        <form id="topupForm">
            <div class="form-group">
                <label for="amount" class="form-label required">–°—É–º–º–∞ –≤ —Ä—É–±–ª—è—Ö</label>
                <input 
                    type="text" 
                    id="amount" 
                    class="form-input"
                    placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –≤ —Ä—É–±–ª—è—Ö"
                    required
                    autocomplete="off"
                >
                <div class="error-message" id="amountError">–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É</div>
            </div>

            <div class="total-display">
                –ö –æ–ø–ª–∞—Ç–µ: <span id="totalRubAmount">0.00</span> <span class="currency">–†–£–ë</span>
                <div style="font-size: 14px; margin-top: 8px; opacity: 0.9;">
                    –≠–∫–≤–∏–≤–∞–ª–µ–Ω—Ç: <span id="usdtAmount">0.00</span> USDT
                </div>
            </div>

            <div class="payment-details">
                <h3>üîê –°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã</h3>
                <div style="padding: 12px; background: #f0f8ff; border-radius: 8px; margin: 10px 0;">
                    <strong>üíé –ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞ (USDT)</strong>
                </div>
                <div style="padding: 8px; background: #fff3cd; border-radius: 6px; margin: 10px 0; font-size: 13px;">
                    ‚ÑπÔ∏è –ö–æ–º–∏—Å—Å–∏—è —Å–µ—Ä–≤–∏—Å–∞: <strong id="commissionInfo">15%</strong>
                </div>
                <p style="color: #666; font-size: 14px;">
                    –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∑–∞—è–≤–∫–∏ —Å –≤–∞–º–∏ —Å–≤—è–∂–µ—Ç—Å—è –æ–ø–µ—Ä–∞—Ç–æ—Ä –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç —Ç–æ—á–Ω—ã–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –æ–ø–ª–∞—Ç—ã
                </p>
            </div>

            <div class="button-group">
                <button type="button" class="btn btn-secondary" id="cancelBtn">
                    ‚ùå –û—Ç–º–µ–Ω–∞
                </button>
                <button type="submit" class="btn btn-primary" id="submitBtn" disabled>
                    ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
                </button>
            </div>
        </form>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        // –≠–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ—Ä–º—ã
        const form = document.getElementById('topupForm');
        const amountInput = document.getElementById('amount');
        const totalRubAmountSpan = document.getElementById('totalRubAmount');
        const usdtAmountSpan = document.getElementById('usdtAmount');
        const submitBtn = document.getElementById('submitBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        const amountError = document.getElementById('amountError');

        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ config.js
        const CONFIG = window.WEBAPP_CONFIG || {
            usdtRate: 95.0,
            commissionPercent: 15.0
        };

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–º–∏—Å—Å–∏—é –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
        document.getElementById('commissionInfo').textContent = CONFIG.commissionPercent + '%';

        // –§—É–Ω–∫—Ü–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å—É–º–º—ã
        function parseAmount(amountStr) {
            if (!amountStr) return 0;
            
            // –ó–∞–º–µ–Ω—è–µ–º –∑–∞–ø—è—Ç—É—é –Ω–∞ —Ç–æ—á–∫—É –∏ —É–¥–∞–ª—è–µ–º –ø—Ä–æ–±–µ–ª—ã
            const cleanAmount = amountStr.replace(',', '.').replace(/\s/g, '');
            const parsed = parseFloat(cleanAmount);
            
            return isNaN(parsed) ? 0 : Math.max(0, parsed);
        }

        // –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ —Å—É–º–º—ã —Å –∫–æ–º–∏—Å—Å–∏–µ–π
        function calculateTotalWithCommission(baseAmount) {
            const commission = 1 + (CONFIG.commissionPercent / 100);
            const total = baseAmount * commission;
            return Math.round(total * 100) / 100; // –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ 2 –∑–Ω–∞–∫–æ–≤
        }

        // –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ USDT
        function calculateUSDT(rubAmount) {
            const usdt = rubAmount / CONFIG.usdtRate;
            return Math.round(usdt * 100) / 100; // –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ 2 –∑–Ω–∞–∫–æ–≤
        }

        // –§—É–Ω–∫—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ñ–æ—Ä–º—ã
        function validateForm() {
            let isValid = true;

            // –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—É–º–º—ã
            const amount = parseAmount(amountInput.value);
            if (amount <= 0) {
                amountError.textContent = '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É –±–æ–ª—å—à–µ 0';
                amountError.style.display = 'block';
                amountInput.style.borderColor = '#e74c3c';
                isValid = false;
            } else {
                amountError.style.display = 'none';
                amountInput.style.borderColor = '';
            }

            return isValid;
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—É–º–º
        function updateTotal() {
            const baseAmount = parseAmount(amountInput.value);
            const totalWithCommission = calculateTotalWithCommission(baseAmount);
            const usdtAmount = calculateUSDT(totalWithCommission);
            
            totalRubAmountSpan.textContent = totalWithCommission.toFixed(2);
            usdtAmountSpan.textContent = usdtAmount.toFixed(2);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏
            const isFormValid = validateForm();
            submitBtn.disabled = !isFormValid;
        }



        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        amountInput.addEventListener('input', updateTotal);

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            
            if (!validateForm()) {
                return;
            }

            const amount = parseAmount(amountInput.value);
            
            const formData = {
                amount: amount,
                timestamp: new Date().toISOString()
            };

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ Telegram
            tg.sendData(JSON.stringify(formData));
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –æ—Ç–º–µ–Ω—ã
        cancelBtn.addEventListener('click', () => {
            tg.close();
        });

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥–ª–∞–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏ Telegram
        tg.MainButton.text = "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞—è–≤–∫—É";
        tg.MainButton.color = "#0088cc";
        
        tg.MainButton.onClick(() => {
            form.dispatchEvent(new Event('submit'));
        });

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω—É—é –∫–Ω–æ–ø–∫—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ —Ñ–æ—Ä–º—ã
        function updateMainButton() {
            if (validateForm() && parseAmount(amountInput.value) > 0) {
                tg.MainButton.show();
            } else {
                tg.MainButton.hide();
            }
        }

        amountInput.addEventListener('input', updateMainButton);

        // –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
        tg.MainButton.hide();

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–º—É
        document.body.style.backgroundColor = tg.themeParams.bg_color || '#ffffff';
        document.body.style.color = tg.themeParams.text_color || '#000000';

        console.log('Crypto Top-Up WebApp –∑–∞–≥—Ä—É–∂–µ–Ω');
    </script>
</body>
</html>
